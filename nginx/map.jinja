{% set nginx = salt['grains.filter_by']({
    'Debian': {
        'pkg': 'nginx-full',
        'port': '80',
        'throttling': {
            'enabled': False,
            'zones': {
                'php': {
                    'rate': '30r/m',
                    'burst': 5,
                }
            }
        },
        'http_core_module_config': {
            'client_max_body_size': '50k',
        }
    },
    'default': 'Debian',
}, merge=salt['pillar.get']('nginx',{})) %}

{% set nginx = salt['grains.filter_by']({
    'Ubuntu-12.04': {
        'version': '1.4.6-1+precise0',
    },
    'Unknown': {
        'version': None
    }
}, grain='osfinger', merge=nginx, default='Unknown') %}


{% set maintenance = {
    'enabled': salt['grains.get']('maintenance',False),
    'password': salt['pillar.get']('maintenance:password','seriouslychangeme'),
} %}


{% set provider = salt['grains.get']('provider','ec2') %}
