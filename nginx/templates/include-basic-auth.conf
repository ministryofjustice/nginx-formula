{% from "nginx/map.jinja" import nginx, maintenance with context %}
{% from "nginx/map_app.jinja" import nginx_app with context %}

{% if nginx_app.auth_basic %}
   auth_basic         "Restricted";
   auth_basic_user_file  {{ nginx_app.auth_basic_user_file }};
{% endif %}

{% if nginx.auth_ext %}

  satisfy any;
  set $realm on;
  if ( $http_x_real_ip ~ "^10\." ) {
  set $realm off;
  }

  if ( $http_x_forwarded_for = "" ) {
  set $realm off;
  }

  if ( $http_x_forwarded_for ~ "^10\." ) {
  set $realm off;
  }

  auth_basic         $realm;
  auth_basic_user_file  {{ nginx_app.auth_basic_user_file }};

{% endif %}
